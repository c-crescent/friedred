# Copilot instructions — Pokémon Rekindled Red

Summary: concise guidance to help an AI coding agent be productive in this repo.

- **Project type:** GBA decompilation / hack based on Pokémon FireRed (C + ARM assembly).
- **Top-level build:** `Makefile` drives building tools and the ROM; see [Makefile](Makefile) and [INSTALL.md](INSTALL.md) for environment setup.

Quick tasks and commands
- Build helper tools (first run): `make tools`
- Build ROM (default): `make firered`
- Build modern toolchain ROM: `make firered_modern` (equivalent to `make GAME_VERSION=FIRERED MODERN=1`)
- Build and validate against committed checksum: `make compare` or `make COMPARE=1`
- Generate symbol listing: `make syms`

Important environment and flags
- `DEVKITARM`/`devkitPro` or `binutils-arm-none-eabi` are required (see [INSTALL.md](INSTALL.md)).
- `MODERN` toggles using system `arm-none-eabi-*` toolchain vs repo `tools/agbcc` pipeline. Many compile rules branch on `MODERN`.
- Common build variables: `GAME_VERSION`, `GAME_REVISION`, `MODERN`.

Repository layout (what to edit vs generated)
- `src/` — primary C & inline assembly sources. Add C files here; the Makefile uses wildcards to include them.
- `asm/` — handwritten assembly source; used directly by the build.
- `data/` — data assembly files and generated map/layout includes; many files here are generated by tools during build. Avoid editing files under `build/` and generated `data/.../maps/*.inc` unless you know the generator.
- `tools/` — small utilities compiled by `make tools` (e.g., `scaninc`, `preproc`, `gbagfx`, `gbafix`). Tools may be rebuilt frequently during development.
- `graphics/`, `sound/` — asset sources that are converted during the build (via tools in `tools/`).
- `build/` — build output; do not commit.

Key build pipeline details (important when editing or adding code)
- C files are preprocessed through `CPP` and `PREPROC` (see `charmap.txt`) before being assembled/compiled. The Makefile step is: `CPP -> PREPROC -> CC1` (look at the `$(C_BUILDDIR)/%.o` rule).
- Many `data/*.s` files are post-processed (scaninc and mapjson) — changing data generation requires touching `tools/*` or the generator inputs in `data/` and `graphics/`.

Code conventions and patterns
- The repo mixes C and ARM assembly; performance- or hardware-sensitive code is often written in hand-optimized `.s` files in `asm/` or `src/*.s`.
- Symbol and link script generation is driven by `sym_*.txt` files and `ramscrgen` in the Makefile. If you need stable addresses, check `sym_common.txt` and the outputs under `build/`.
- Naming: targets like `firered`, `leafgreen`, and `_modern` variants are canonical; use these when scripting CI or local builds.

Debugging and verification tips
- Use `make syms` and the produced `.sym` file (root) to map addresses to symbols.
- Use `make compare` to ensure your change doesn't alter committed ROM bytes (useful for preservation patches).

What not to touch
- Do not commit files under `build/` or generated data (`data/.../maps/*.inc`, autogenerated layout files).
- Avoid editing `tools/` binaries directly — rebuild with `make tools` when adjusting generators.

References (quick links)
- Root README: [README.md](README.md)
- Installation & environment: [INSTALL.md](INSTALL.md)
- Build file with compile pipeline: [Makefile](Makefile)
- Source tree: [src/](src/), [data/](data/), [asm/](asm/), [tools/](tools/)

If anything above is unclear or you want more examples (e.g., where a specific feature is implemented or how to add a new Pokémon or map), tell me which area to expand and I will add short, targeted snippets and file links.
